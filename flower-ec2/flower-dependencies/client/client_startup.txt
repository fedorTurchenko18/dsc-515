#!/bin/bash
set -x
INSTANCE_ID = ec2-metadata -i
INSTANCE_ID = $(echo $INSTANCE_ID | cut -d' ' -f2-)
export AWS_LAB_ACCESS_KEY=ACCESS_KEY
export AWS_LAB_SECRET_ACCESS_KEY=SECRET_ACCESS_KEY
export AWS_LAB_SESSION_TOKEN=SESSION_TOKEN
export AWS_REGION=REGION
export AWS_KEY_PAIR=KEY_PAIR
source ~/.bashrc
sudo yum -y install python3-pip
sudo yum -y install git
cd /home/ec2-user
git clone --depth 1 --filter=blob:none --no-checkout https://github.com/fedorTurchenko18/dsc-515.git
cd dsc-515/
git sparse-checkout init --cone
git sparse-checkout set flower-ec2/flower-dependencies/client flower-ec2/flower-dependencies/model.py flower-ec2/aws_management images_houseware
git checkout
cd flower-ec2/flower-dependencies/client
while read -r package; do
    pip install "$package" --no-cache-dir -q
done < requirements.txt
python3 run_client.py --backend=BACKEND --public_ip=PUBLIC_IP --data_n=DATA_N --data_index=DATA_INDEX --instance_id=INSTANCE_ID